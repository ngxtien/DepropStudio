<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sốp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* CSS cho icon giỏ hàng */
        .cart-icon {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 24px;
        }
    </style>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .product {
            border-bottom: 1px solid #ddd;
            padding: 20px 0;
            display: flex;
            align-items: center;
        }

        .product img {
            max-width: 100px;
            max-height: 100px;
            margin-right: 20px;
        }

        .product-info {
            flex: 1;
        }

        .product h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .product p {
            margin: 5px 0;
            color: #777;
        }
    </style>
</head>
<body>
<div class="cart-icon" >
    <a href="/cart">
        <i class="fas fa-shopping-cart" ></i>
        <span id="cart-count">0</span>
    </a>
</div>
<div class="container">
    <h2>Product List</h2>
<!--    <div th:if="${product.empty}">No products available</div>-->
    <div th:each="product : ${product}" class="product">
        <img th:src="@{'data:image/png;base64,' + ${product.image}}" alt="Product Image">
        <div class="product-info">
            <h3>
                <a th:href="@{'/product_detail/' + ${product.id}}" th:text="${product.name}"></a>
            </h3>
            <p th:text="${product.description}"></p>
            <p th:text="'Price: ' + ${product.price}"></p>
            <p th:text="'Quantity: ' + ${product.quantity}"></p>
            <button class="add-to-cart" th:data-id="${product.id}">Add to Cart</button>
            <button id="clear-cart" class="btn btn-danger">Clear Cart</button>

        </div>
    </div>
</div>

</body>
</html>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const cartCount = document.getElementById("cart-count");
        const addToCartButtons = document.querySelectorAll(".add-to-cart");

        addToCartButtons.forEach(button => {
            button.addEventListener("click", function() {
                const productId = this.getAttribute("data-id");
                const quantityInput = this.parentNode.querySelector('.quantity-input');
                const quantity = quantityInput ? parseInt(quantityInput.value) : 1; // Số lượng mặc định là 1 nếu không có trường số lượng

                fetch(`/add-to-cart/${productId}?quantity=${quantity}`, {
                    method: 'POST'
                }).then(response => {
                    if (response.ok) {
                        alert('Product added to cart');
                        console.log(productId);

                        // Update cart count
                        let cart = JSON.parse(localStorage.getItem('cart')) || [];
                        const existingProduct = cart.find(item => item.id == productId);
                        if (existingProduct) {
                            existingProduct.quantity += quantity;
                        } else {
                            cart.push({ id: productId, quantity: quantity });
                        }
                        localStorage.setItem('cart', JSON.stringify(cart));
                        cartCount.textContent = cart.reduce((acc, item) => acc + item.quantity, 0);
                    } else {
                        alert('Failed to add product to cart');
                    }
                }).catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred');
                });
            });
        });

        // Update cart count on page load
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        cartCount.textContent = cart.reduce((acc, item) => acc + item.quantity, 0);
    });

    document.addEventListener("DOMContentLoaded", function() {
        const clearCartButton = document.getElementById("clear-cart");

        clearCartButton.addEventListener("click", function() {
            localStorage.removeItem('cart');
            cartCount.textContent = 0;
        });
    });

</script>
