<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Product Detail</title>
<!--    <link rel="stylesheet" type="text/css" href="/static/css/styles.css">-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* CSS cho icon giỏ hàng */
        .cart-icon {
            position: fixed;
            top: 10px;
            right: 10px;
            font-size: 24px;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .product-detail {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .product-detail img {
            max-width: 300px;
            max-height: 300px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .product-detail h1 {
            margin: 0;
            font-size: 32px;
            color: #333;
        }

        .product-detail h2 {
            margin: 10px 0;
            font-size: 28px;
            color: #555;
        }

        .product-detail p {
            font-size: 18px;
            color: #666;
            text-align: center;
            margin: 10px 0;
        }

        .product-detail h3 {
            font-size: 24px;
            color: #333;
            margin: 10px 0;
        }

        .product-detail button {
            padding: 10px 20px;
            font-size: 16px;
            color: #fff;
            background-color: #007bff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .product-detail button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
<div class="cart-icon">
    <a href="/cart">
        <i class="fas fa-shopping-cart"></i>
        <span id="cart-count">0</span>
    </a>
</div>
<h1>Product Detail</h1>
<div class="product-detail">
    <img th:src="@{'data:image/png;base64,' + ${product.image}}" alt="Product Image">
    <h2 th:text="${product.name}"></h2>
    <p  th:text="${product.description}"></p>
    <h3 th:text="${product.price}"></h3>
    <button id="addToCartButton" th:data-id="${product.id}">Add to Cart</button>
</div>
<button id="clear-cart" class="btn btn-danger">Clear Cart</button>

<!--<script>-->
<!--    document.addEventListener("DOMContentLoaded", function() {-->
<!--        document.getElementById("addToCartButton").addEventListener("click", function() {-->
<!--            const productId = this.getAttribute("data-id");-->
<!--            fetch(`/add-to-cart/${productId}`, {-->
<!--                method: 'POST'-->
<!--            }).then(response => {-->
<!--                if (response.ok) {-->
<!--                    alert('Product added to cart');-->
<!--                    console.log(productId);-->
<!--                } else {-->
<!--                    alert('Failed to add product to cart');-->
<!--                }-->
<!--            }).catch(error => {-->
<!--                console.error('Error:', error);-->
<!--                alert('An error occurred');-->
<!--            });-->
<!--        });-->
<!--    });-->
<!--</script>-->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const cartCount = document.getElementById("cart-count");

        document.getElementById("addToCartButton").addEventListener("click", function() {
            const productId = this.getAttribute("data-id");
            const quantityInput = document.getElementById('quantityInput');
            const quantity = quantityInput ? parseInt(quantityInput.value) : 1; // Số lượng mặc định là 1 nếu không có trường số lượng

            fetch(`/add-to-cart/${productId}?quantity=${quantity}`, {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    alert('Product added to cart');
                    console.log(productId);

                    // Update cart count
                    let cart = JSON.parse(localStorage.getItem('cart')) || [];
                    const existingProduct = cart.find(item => item.id == productId);
                    if (existingProduct) {
                        existingProduct.quantity += quantity;
                    } else {
                        cart.push({ id: productId, quantity: quantity });
                    }
                    localStorage.setItem('cart', JSON.stringify(cart));
                    cartCount.textContent = cart.reduce((acc, item) => acc + item.quantity, 0);
                } else {
                    alert('Failed to add product to cart');
                }
            }).catch(error => {
                console.error('Error:', error);
                alert('An error occurred');
            });
        });

        // Update cart count on page load
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        cartCount.textContent = cart.reduce((acc, item) => acc + item.quantity, 0);
    });

    document.addEventListener("DOMContentLoaded", function() {
        const clearCartButton = document.getElementById("clear-cart");

        clearCartButton.addEventListener("click", function() {
            localStorage.removeItem('cart');
            cartCount.textContent = 0;
        });
    });
    document.addEventListener("DOMContentLoaded", function() {
        const clearCartButton = document.getElementById("clear-cart");

        clearCartButton.addEventListener("click", function() {
            localStorage.removeItem('cart');
            cartCount.textContent = 0;
        });
    });

</script>


</body>
</html>
